import streamlit as st
import openai
from datetime import datetime

# üîê SETUP OpenAI KEY (‡πÉ‡∏™‡πà Key ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
openai.organization = "org-GELun61bLnDGutYVF1OIe9Pc"
openai.api_key = "sk-Gm-7fUM-TkSdeJQAUNcYKLw7LE-_hT0Mrmq-4pAhjJT3BlbkFJ7dupKD-NLCbp2qV5m359wUCnHr3o9yUWI475eGQEwA"

# --- UI
st.title("üîÆ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏ß‡∏á‡∏à‡∏µ‡∏ô BaZi (GPT Edition)")

birth_date = st.date_input("üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î")
birth_time = st.time_input("‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î")
gender = st.selectbox("‡πÄ‡∏û‡∏®", ["‡∏ä‡∏≤‡∏¢", "‡∏´‡∏ç‡∏¥‡∏á"])

# --- ‡πÄ‡∏™‡∏≤ 4 ‡∏´‡∏•‡∏±‡∏Å (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)
pillars = {
    "‡∏õ‡∏µ": ("Êàä", "Âçà"),
    "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô": ("Ëæõ", "ÈÖâ"),
    "‡∏ß‡∏±‡∏ô": ("‰πô", "‰∫•"),
    "‡πÄ‡∏ß‡∏•‡∏≤": ("‰πô", "ÈÖâ")
}
day_master = pillars["‡∏ß‡∏±‡∏ô"][0]  # '‰πô'

# --- GPT: ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
def ask_gpt(day_master, gender):
    prompt = f"""
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ã‡∏¥‡∏ô‡πÅ‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡∏ß‡∏á‡∏à‡∏µ‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏ß‡∏á‡∏ï‡∏≤‡∏°‡∏ò‡∏≤‡∏ï‡∏∏‡∏î‡∏¥‡∏ñ‡∏µ {day_master} ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏® {gender}
‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏µ 2025 (‰πôÂ∑≥Âπ¥) ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÉ‡∏´‡πâ 3 ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:

1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å
2. ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
3. ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û

‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢
‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏™‡∏£‡∏∏‡∏õ
"""
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ã‡∏¥‡∏ô‡πÅ‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡∏ß‡∏á‡∏à‡∏µ‡∏ô"},
            {"role": "user", "content": prompt}
        ]
    )
    return response.choices[0].message.content

# --- ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢
if st.button("üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏ß‡∏á‡∏î‡πâ‡∏ß‡∏¢ GPT"):
    with st.spinner("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å GPT ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå..."):
        result = ask_gpt(day_master, gender)
        st.subheader("üß† ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÇ‡∏î‡∏¢ GPT:")
        st.markdown(result)
